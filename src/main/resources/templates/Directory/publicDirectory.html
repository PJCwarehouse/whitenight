<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <style>
      /* æ ·å¼éƒ¨åˆ† */
      body {
        font-family: Arial, sans-serif;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: stretch; /* å‚ç›´æ–¹å‘ä¸Šæ‹‰ä¼¸ä»¥é€‚åº”å†…å®¹ */
      }

      .toolbar {
        display: flex;
        justify-content: space-between; /* å·¦å³ä¸¤ä¾§å¯¹é½ */
        align-items: center; /* å‚ç›´å±…ä¸­ */
        padding: 10px;
        background-color: #f0f0f0;
        border-bottom: 1px solid #ccc;
      }

      .toolbar button {
        margin-right: 10px;
        padding: 5px 10px;
        border: none;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }

      .toolbar button:hover {
        background-color: #0056b3;
      }

      .toolbar .search {
        margin-left: auto;
        display: flex;
        align-items: center;
      }

      .toolbar input[type="text"] {
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }

      .toolbar .view-buttons button {
        background-color: #f0f0f0;
        color: #000;
        border: 1px solid #ccc;
        border-radius: 3px;
      }

      .toolbar .view-buttons button:hover {
        background-color: #ccc;
      }

      /*è¿”å›å’Œè·¯å¾„*/
      .link {
        display: flex; /* å‡è®¾ .link æ˜¯ä¸€ä¸ª Flex å®¹å™¨ */
        align-items: center; /* å‚ç›´å±…ä¸­ */
      }

      .link a {
        text-decoration: none;
        color: #007bff; /* æŒ‰é’®é¢œè‰² */
        margin-right: 10px; /* æŒ‰é’®å³ä¾§é—´è· */
      }

      .link .path {
        flex: 1; /* è®©è·¯å¾„éƒ¨åˆ†å æ®å‰©ä½™ç©ºé—´ */
        text-align: right; /* å³å¯¹é½ */
        margin-top: 0; /* æ ¹æ®éœ€è¦è°ƒæ•´é—´è· */
      }

      .link .path p {
        margin-bottom: 5px; /* æ®µè½åº•éƒ¨é—´è· */
      }

      .link .path span {
        margin-left: 5px; /* åˆ†æ®µè·¯å¾„ä¹‹é—´çš„é—´è· */
      }

      .link .path a {
        text-decoration: none; /* å»é™¤é“¾æ¥çš„ä¸‹åˆ’çº¿ */
        color: #007bff; /* é“¾æ¥é¢œè‰² */
      }

      .link .path a:hover {
        text-decoration: underline; /* é¼ æ ‡æ‚¬åœæ—¶æ·»åŠ ä¸‹åˆ’çº¿ */
      }

      .file-container {
        padding: 10px;
      }

      .file-item {
        cursor: pointer;
        padding: 10px;
        border: 1px solid #ccc;
        margin: 5px;
      }

      .file-item.selected {
        /*background-color: #e0e0e0; !* è®¾ç½®é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯è‰² *!*/
        background-color: yellow;
      }

      .grid-view {
        display: grid;
        grid-template-columns: repeat(auto-fill, 150px);
        gap: 10px;
      }

      .grid-view .file-item {
        width: 150px;
        height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        box-sizing: border-box;
      }

      /* é»˜è®¤åˆ—è¡¨è§†å›¾æ ·å¼ */
      .list-view .file-details {
        display: block; /* æ˜¾ç¤ºæ–‡ä»¶è¯¦ç»†ä¿¡æ¯ */
      }

      /* ç½‘æ ¼è§†å›¾æ ·å¼ */
      .grid-view .file-details {
        display: none; /* éšè—æ–‡ä»¶è¯¦ç»†ä¿¡æ¯ */
      }

      .list-view .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        border: 1px solid #ccc;
        margin: 5px;
      }

      .list-view .file-item .file-details {
        flex-shrink: 0; /* é˜²æ­¢è¯¦æƒ…éƒ¨åˆ†æ‰©å±• */
        margin-left: 10px;
      }

      /* å¼¹å‡ºæ¡†çš„æ ·å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
      }

      .modal-content input[type="text"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }

      .modal-content button {
        padding: 10px 20px;
        border: none;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }

      .modal-content button:hover {
        background-color: #0056b3;
      }

      .modal-content .cancel-btn {
        background-color: #ccc;
      }

      .modal-content .cancel-btn:hover {
        background-color: #999;
      }
  </style>
</head>
<body>
<div class="container">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <div class="toolbar">
    <div class="search">
      <input type="text" placeholder="æœç´¢æ‚¨çš„æ–‡ä»¶">
      <button>ğŸ”</button>
    </div>
    <button onclick="performAction('download')">Download Select</button>
    <div class="view-buttons">
      <button onclick="toggleView('list')">åˆ—è¡¨è§†å›¾</button>
      <button onclick="toggleView('grid')">ç½‘æ ¼è§†å›¾</button>
    </div>
    <!-- æŒ‰é’®å’Œæœç´¢æ¡†ç­‰ -->
  </div>
  <div class="link">
    <a th:href="@{/returnParentDisplay(directoryId=${parentId})}">è¿”å›</a>
    <div class="path">
      <p>è·¯å¾„:
        <span th:each="segment, iterStat : ${pathSegments}">
                    <span th:if="${!iterStat.first}">/</span>
                    <a th:href="@{/publicDirectory(parentId=${segment.parentId})}" th:text="${segment.name}"></a>
                </span>
      </p>
    </div>
  </div>

  <!-- æ–‡ä»¶æ˜¾ç¤ºåŒºåŸŸ -->
  <div id="file-container" class="list-view file-container">
    <!-- æ˜¾ç¤ºæ–‡ä»¶å¤¹ -->
    <div th:each="directory : ${directoryList}">
      <div class="file-item" th:onclick="'toggleSelect(event, this, \'directory\', ' + ${directory.id} + ')'">
        <input type="hidden" name="directoryId" th:value="${directory.id}">
        <!--                é€šè¿‡ event.stopPropagation() æ–¹æ³•ï¼Œé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œå¯ä»¥ç¡®ä¿ç‚¹å‡»æ–‡ä»¶åé“¾æ¥æ—¶ä¸ä¼šè§¦å‘å¤–å±‚ div çš„ç‚¹å‡»äº‹ä»¶-->
        <!--                ä»è€Œé¿å…ä¸å¿…è¦çš„é€‰ä¸­çŠ¶æ€åˆ‡æ¢ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­éå¸¸é‡è¦ï¼Œå› ä¸ºä½ å¸Œæœ›ç‚¹å‡»é“¾æ¥æ—¶è·³è½¬ï¼Œè€Œä¸æ˜¯åˆ‡æ¢é€‰ä¸­çŠ¶æ€ã€‚-->
        <a class="file-info" th:href="@{/publicDirectory(parentId=${directory.id})}" th:text="${directory.name}" onclick="event.stopPropagation()"></a>
        <!--                <div class="file-details">-->
        <!--                    <span>ç›®å½•å¤§å°: 100MB</span>-->
        <!--                </div>-->
      </div>
    </div>
    <!-- æ˜¾ç¤ºæ–‡ä»¶ -->
    <div th:each="file : ${fileList}">
      <div class="file-item" th:onclick="'toggleSelect(event, this, \'file\', ' + ${file.id} + ')'">
        <input type="hidden" name="fileId" th:value="${file.id}">
        <div class="file-info" th:text="${file.name}"></div>
        <div class="file-details">
          <span>æ–‡ä»¶å¤§å°: <span th:text="${file.size} + ' ' + ${file.sizeUnit}"></span></span>
          <span>ä¸Šä¼ æ—¶é—´:</span><span th:text="${file.time}"></span>
        </div>
        <div class="file-actions">
          <!-- å¤åˆ¶ä¸‹è½½é“¾æ¥ -->
          <a href="#" th:attr="data-url=${file.url}" onclick="copyDownloadLink(event, this)">å¤åˆ¶ä¸‹è½½é“¾æ¥</a>
          <!-- ä¸‹è½½ -->
          <a th:href="${file.url}" target="_blank" onclick="event.stopPropagation()">ä¸‹è½½</a>
        </div>
      </div>
    </div>
  </div>



  <!-- æ–°å»ºæ–‡ä»¶å¤¹å¼¹å‡ºæ¡† -->
  <div id="createFolderModal" class="modal">
    <div class="modal-content">
      <span>Name your new directory.</span>
      <input type="text" id="newFolderName" placeholder="è¾“å…¥æ–‡ä»¶å¤¹åç§°">
      <button onclick="createFolder()">CREATE</button>
      <button class="cancel-btn" onclick="closeCreateFolderModal()">CANCEL</button>
    </div>
  </div>
</div>
<script type="text/javascript">
  let selectedFiles = [];
  let selectedDirectories = [];

  // é€‰æ‹©æ–‡ä»¶å’Œç›®å½•
  function toggleSelect(event, element, type, id) {
    // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
    element.classList.toggle('selected');

    // æ ¹æ®ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œ
    if (type === 'directory') {
      // å¤„ç†é€‰ä¸­æ–‡ä»¶å¤¹çš„é€»è¾‘
      if (selectedDirectories.includes(id)) {
        selectedDirectories = selectedDirectories.filter(dirId => dirId !== id);
      } else {
        selectedDirectories.push(id);
      }
    } else if (type === 'file') {
      // å¤„ç†é€‰ä¸­æ–‡ä»¶çš„é€»è¾‘
      if (selectedFiles.includes(id)) {
        selectedFiles = selectedFiles.filter(fileId => fileId !== id);
      } else {
        selectedFiles.push(id);
      }
    }

    console.log('Selected Files:', selectedFiles);
    console.log('Selected Directories:', selectedDirectories);
  }

  // ä¸‹è½½æˆ–è€…åˆ é™¤æ–‡ä»¶å’Œç›®å½•
  function performAction(action) {
    if (selectedFiles.length === 0 && selectedDirectories.length === 0) {
      alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•');
      return;
    }
    fetch(`/perform-${action}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ files: selectedFiles, directories: selectedDirectories })
    }).then(response => {
      if (response.ok) {
        alert('æ­£åœ¨ä¸‹è½½');
        return response.blob();
      } else {
        alert('æ“ä½œå¤±è´¥');
      }
    }).then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'download.zip';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        window.location.reload();
    });
  }

  // å¤åˆ¶ä¸‹è½½é“¾æ¥åˆ°å‰ªè´´æ¿
  function copyDownloadLink(event, element) {
    event.stopPropagation();

    event.preventDefault();
    const url = element.getAttribute('data-url');

    // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„è¾“å…¥å…ƒç´ 
    const tempInput = document.createElement('input');
    tempInput.style.position = 'absolute';
    tempInput.style.left = '-9999px';
    tempInput.value = url;

    // å°†ä¸´æ—¶è¾“å…¥å…ƒç´ æ·»åŠ åˆ°æ–‡æ¡£
    document.body.appendChild(tempInput);

    // é€‰æ‹©å¹¶å¤åˆ¶è¾“å…¥å…ƒç´ çš„å†…å®¹
    tempInput.select();
    document.execCommand('copy');

    // ç§»é™¤ä¸´æ—¶è¾“å…¥å…ƒç´ 
    document.body.removeChild(tempInput);

    alert('ä¸‹è½½é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿: ' + url);
  }
</script>
</body>
</html>