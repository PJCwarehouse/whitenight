<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Manager</title>
    <style>
        /* æ ·å¼éƒ¨åˆ† */
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: stretch; /* å‚ç›´æ–¹å‘ä¸Šæ‹‰ä¼¸ä»¥é€‚åº”å†…å®¹ */
        }

        .toolbar {
            display: flex;
            justify-content: space-between; /* å·¦å³ä¸¤ä¾§å¯¹é½ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            padding: 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ccc;
        }

        .toolbar button {
            margin-right: 10px;
            padding: 5px 10px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }

        .toolbar button:hover {
            background-color: #0056b3;
        }

        .toolbar .search {
            margin-left: auto;
            display: flex;
            align-items: center;
        }

        .toolbar input[type="text"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .toolbar .view-buttons button {
            background-color: #f0f0f0;
            color: #000;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .toolbar .view-buttons button:hover {
            background-color: #ccc;
        }

        .link {
            display: flex; /* å‡è®¾ .link æ˜¯ä¸€ä¸ª Flex å®¹å™¨ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
        }

        .link a {
            text-decoration: none;
            color: #007bff; /* æŒ‰é’®é¢œè‰² */
            margin-right: 10px; /* æŒ‰é’®å³ä¾§é—´è· */
        }

        .link .path {
            flex: 1; /* è®©è·¯å¾„éƒ¨åˆ†å æ®å‰©ä½™ç©ºé—´ */
            text-align: right; /* å³å¯¹é½ */
            margin-top: 0; /* æ ¹æ®éœ€è¦è°ƒæ•´é—´è· */
        }

        .link .path p {
            margin-bottom: 5px; /* æ®µè½åº•éƒ¨é—´è· */
        }

        .link .path span {
            margin-left: 5px; /* åˆ†æ®µè·¯å¾„ä¹‹é—´çš„é—´è· */
        }

        .link .path a {
            text-decoration: none; /* å»é™¤é“¾æ¥çš„ä¸‹åˆ’çº¿ */
            color: #007bff; /* é“¾æ¥é¢œè‰² */
        }

        .link .path a:hover {
            text-decoration: underline; /* é¼ æ ‡æ‚¬åœæ—¶æ·»åŠ ä¸‹åˆ’çº¿ */
        }

        .file-container {
            padding: 10px;
        }

        .file-item {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ccc;
            margin: 5px;
        }

        .grid-view .file-item {
            display: inline-block;
            width: 150px;
            text-align: center;
        }

        .list-view .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #ccc;
            margin: 5px;
        }

        .list-view .file-item .file-info {
            flex: 1; /* è®©æ–‡ä»¶åå æ®å‰©ä½™ç©ºé—´ */
            max-width: 300px; /* è®¾ç½®æœ€å¤§å®½åº¦ä¸º300åƒç´ ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ */
            overflow: hidden; /* è¶…å‡ºéƒ¨åˆ†éšè— */
            text-overflow: ellipsis; /* ç”¨çœç•¥å·è¡¨ç¤ºè¶…å‡ºéƒ¨åˆ† */
            white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
        }


        .list-view .file-item .file-details {
            flex-shrink: 0; /* é˜²æ­¢è¯¦æƒ…éƒ¨åˆ†æ‰©å±• */
            margin-left: 10px;
        }

    </style>
</head>
<body>
<input type="hidden" id="parent_tableId" th:value="${parent_tableId}"/>
<!-- é¡¶éƒ¨å·¥å…·æ  -->
<div class="container">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="toolbar">
        <button onclick="document.getElementById('fileInput').click()">ä¸Šä¼ </button>
        <input type="file" id="fileInput" accept=".pdf" multiple style="display: none;">

        <button onclick="createFolder()">æ–°å»ºæ–‡ä»¶å¤¹</button>
        <div class="search">
            <input type="text" placeholder="æœç´¢æ‚¨çš„æ–‡ä»¶">
            <button>ğŸ”</button>
        </div>
        <button onclick="performAction('delete')">Delete Selected</button>
        <button onclick="performAction('download')">Download Selected</button>
        <div class="view-buttons">
            <button onclick="switchView('grid')">ç½‘æ ¼è§†å›¾</button>
            <button onclick="switchView('list')">åˆ—è¡¨è§†å›¾</button>
        </div>
        <!-- æŒ‰é’®å’Œæœç´¢æ¡†ç­‰ -->
    </div>
    <div class="link">
        <a th:href="@{/returnParentTable(directoryId=${parent_tableId})}">è¿”å›</a>
        <div class="path">
            <p>è·¯å¾„:
                <span th:each="segment, iterStat : ${pathSegments}">
                    <span th:if="${!iterStat.first}">/</span>
                    <a th:href="@{/userDirectory(parent_tableId=${segment.parentId})}" th:text="${segment.name}"></a>
                </span>
            </p>
        </div>
    </div>

    <!-- æ–‡ä»¶æ˜¾ç¤ºåŒºåŸŸ -->
    <div id="file-container" class="list-view file-container" th:each="directory : ${directoryList}">
        <div class="file-item" onclick="toggleSelect(this, 'Big Bunny.mp4')">
            <input type="hidden" name="fileId" th:value="${directory.id}">
            <div class="file-info" th:text="${directory.directoryName}">Big Bunny.mp4</div>
            <div class="file-details">
                <span>æ–‡ä»¶å¤§å°: 100MB</span>
<!--                <span>ä¸Šä¼ æ—¶é—´:</span><span th:text="${directory.time}"></span>-->
            </div>
        </div>
    </div>

</div>

<!-- JavaScriptéƒ¨åˆ† -->
<script>
    function uploadFiles() {
        var files = document.getElementById('fileInput').files;
        let formData = new FormData();
        for (var i = 0; i < files.length; i++) {
            console.log("ä¸Šä¼ çš„æ–‡ä»¶æ˜¯:", files[i].name);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å°†æ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨çš„ä»£ç 
            formData.append('file', files[i]);
        }
        let parent_tableId = document.getElementById('parent_tableId').value;
        formData.append('parent_tableId', parent_tableId);
        fetch('/fileUpload', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    console.error('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');
                } else {
                    console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥');
                }
            })
            .catch(error => console.error('å‘ç”Ÿé”™è¯¯:', error));
    }
    document.getElementById('fileInput').addEventListener('change', uploadFiles);

    // ç›‘å¬æ–‡ä»¶é€‰æ‹©å™¨çš„å˜åŒ–ï¼Œä¸€æ—¦ç”¨æˆ·é€‰æ‹©äº†æ–‡ä»¶ï¼Œå°±è°ƒç”¨uploadFileså‡½æ•°

    function createFolder() {
        // æ–°å»ºæ–‡ä»¶å¤¹çš„é€»è¾‘
        alert('æ–°å»ºæ–‡ä»¶å¤¹');
    }

    let selectedFiles = [];

    function toggleSelect(element, fileName) {
        element.classList.toggle('selected');
        if (selectedFiles.includes(fileName)) {
            selectedFiles = selectedFiles.filter(file => file !== fileName);
        } else {
            selectedFiles.push(fileName);
        }
        console.log(selectedFiles);
    }

    function performAction(action) {
        fetch(`/perform-${action}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ files: selectedFiles })
        }).then(response => {
            if (response.ok) {
                console.log(`${action} successful`);
            } else {
                console.error(`${action} failed`);
            }
        });
    }

    function switchView(view) {
        const fileContainer = document.getElementById('file-container');
        if (view === 'grid') {
            fileContainer.classList.add('grid-view');
            fileContainer.classList.remove('list-view');
        } else {
            fileContainer.classList.add('list-view');
            fileContainer.classList.remove('grid-view');
        }
    }
</script>
</body>
</html>
